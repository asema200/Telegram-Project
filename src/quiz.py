'''–ú–æ–¥—É–ª—å –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã –¥–ª—è –ø—Ä–æ—Ñ–æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏'''

# –í–æ–ø—Ä–æ—Å—ã –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã
QUIZ_QUESTIONS = [
    {
        'question': '1Ô∏è‚É£ –ß—Ç–æ —Ç–µ–±–µ –±–æ–ª—å—à–µ –Ω—Ä–∞–≤–∏—Ç—Å—è?',
        'options': [
            {'text': '–†–∞–±–æ—Ç–∞—Ç—å —Å –ª—é–¥—å–º–∏ üë•', 'traits': ['social', 'communication']},
            {'text': '–†–∞–±–æ—Ç–∞—Ç—å —Å –¥–∞–Ω–Ω—ã–º–∏ üìä', 'traits': ['analytical', 'technical']},
            {'text': '–°–æ–∑–¥–∞–≤–∞—Ç—å —á—Ç–æ-—Ç–æ –Ω–æ–≤–æ–µ üé®', 'traits': ['creative', 'artistic']},
            {'text': '–†–µ—à–∞—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ üíª', 'traits': ['technical', 'logical']}
        ]
    },
    {
        'question': '2Ô∏è‚É£ –ö–∞–∫–∞—è —Ä–∞–±–æ—á–∞—è –æ–±—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–±–µ –±–ª–∏–∂–µ?',
        'options': [
            {'text': '–û—Ñ–∏—Å —Å –∫–æ–º–∞–Ω–¥–æ–π üè¢', 'traits': ['social', 'collaborative']},
            {'text': '–£–¥–∞–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ üè†', 'traits': ['independent', 'flexible']},
            {'text': '–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è –∏ –≤—Å—Ç—Ä–µ—á–∏ ‚úàÔ∏è', 'traits': ['social', 'dynamic']},
            {'text': '–¢–∏—Ö–æ–µ –º–µ—Å—Ç–æ –¥–ª—è –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏ ü§´', 'traits': ['focused', 'independent']}
        ]
    },
    {
        'question': '3Ô∏è‚É£ –ß—Ç–æ —Ç–µ–±—è –±–æ–ª—å—à–µ –º–æ—Ç–∏–≤–∏—Ä—É–µ—Ç?',
        'options': [
            {'text': '–ü–æ–º–æ–≥–∞—Ç—å –ª—é–¥—è–º ü§ù', 'traits': ['social', 'helping']},
            {'text': '–í—ã—Å–æ–∫–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞ üí∞', 'traits': ['ambitious', 'financial']},
            {'text': '–¢–≤–æ—Ä—á–µ—Å–∫–∞—è —Å–≤–æ–±–æ–¥–∞ üé≠', 'traits': ['creative', 'freedom']},
            {'text': '–°–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏ üß©', 'traits': ['analytical', 'challenging']}
        ]
    },
    {
        'question': '4Ô∏è‚É£ –¢–≤–æ–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:',
        'options': [
            {'text': '–û–±—â–µ–Ω–∏–µ –∏ —É–±–µ–∂–¥–µ–Ω–∏–µ üó£Ô∏è', 'traits': ['social', 'leadership']},
            {'text': '–õ–æ–≥–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏–∑ üß†', 'traits': ['analytical', 'logical']},
            {'text': '–ö—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å üé®', 'traits': ['creative', 'artistic']},
            {'text': '–í–Ω–∏–º–∞–Ω–∏–µ –∫ –¥–µ—Ç–∞–ª—è–º üîç', 'traits': ['detail-oriented', 'precise']}
        ]
    },
    {
        'question': '5Ô∏è‚É£ –ö–∞–∫–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã —Ç–µ–±–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–µ–µ?',
        'options': [
            {'text': '–ì—É–º–∞–Ω–∏—Ç–∞—Ä–Ω—ã–µ (—è–∑—ã–∫–∏, –∏—Å—Ç–æ—Ä–∏—è) üìö', 'traits': ['social', 'communication']},
            {'text': '–¢–æ—á–Ω—ã–µ –Ω–∞—É–∫–∏ (–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞, —Ñ–∏–∑–∏–∫–∞) üî¢', 'traits': ['analytical', 'technical']},
            {'text': '–ò—Å–∫—É—Å—Å—Ç–≤–æ –∏ –¥–∏–∑–∞–π–Ω üé®', 'traits': ['creative', 'artistic']},
            {'text': '–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ üíª', 'traits': ['technical', 'logical']}
        ]
    },
    {
        'question': '6Ô∏è‚É£ –¢–≤–æ–π –∏–¥–µ–∞–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç:',
        'options': [
            {'text': '–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ üéâ', 'traits': ['social', 'organizational']},
            {'text': '–ü—Ä–æ–≤–µ—Å—Ç–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ üî¨', 'traits': ['analytical', 'research']},
            {'text': '–°–æ–∑–¥–∞—Ç—å –¥–∏–∑–∞–π–Ω –∏–ª–∏ –≤–∏–¥–µ–æ üé¨', 'traits': ['creative', 'artistic']},
            {'text': '–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ üì±', 'traits': ['technical', 'logical']}
        ]
    },
    {
        'question': '7Ô∏è‚É£ –ö–∞–∫ —Ç—ã –æ—Ç–Ω–æ—Å–∏—à—å—Å—è –∫ —Ä—É—Ç–∏–Ω–µ?',
        'options': [
            {'text': '–õ—é–±–ª—é —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å ‚úÖ', 'traits': ['stable', 'organized']},
            {'text': '–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ üé≤', 'traits': ['dynamic', 'flexible']},
            {'text': '–ì–ª–∞–≤–Ω–æ–µ - —Ä–µ–∑—É–ª—å—Ç–∞—Ç üéØ', 'traits': ['goal-oriented', 'ambitious']},
            {'text': '–ù—É–∂–µ–Ω –±–∞–ª–∞–Ω—Å ‚öñÔ∏è', 'traits': ['balanced', 'adaptable']}
        ]
    }
]

# –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏
CAREER_PROFILES = {
    'technical': {
        'name': '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å—Ñ–µ—Ä–∞ üíª',
        'professions': [
            '–ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç',
            '—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫',
            '—Å–∏—Å—Ç–µ–º–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
            'DevOps –∏–Ω–∂–µ–Ω–µ—Ä',
            '—Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫ –ü–û'
        ],
        'description': '–¢–µ–±–µ –ø–æ–¥—Ö–æ–¥—è—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏! –¢—ã –ª—é–±–∏—à—å —Ä–µ—à–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏, —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∫–æ–¥–æ–º –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è.'
    },
    'analytical': {
        'name': '–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –¥–∞–Ω–Ω—ã–µ üìä',
        'professions': [
            '–∞–Ω–∞–ª–∏—Ç–∏–∫ –¥–∞–Ω–Ω—ã—Ö',
            'data scientist',
            '–±–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫',
            '—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫',
            '–∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å'
        ],
        'description': '–¢–µ–±–µ –ø–æ–¥—Ö–æ–¥–∏—Ç —Ä–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏! –¢—ã —É–º–µ–µ—à—å –Ω–∞—Ö–æ–¥–∏—Ç—å –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏, –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ –¥–µ–ª–∞—Ç—å –≤—ã–≤–æ–¥—ã.'
    },
    'creative': {
        'name': '–ö—Ä–µ–∞—Ç–∏–≤–Ω–∞—è —Å—Ñ–µ—Ä–∞ üé®',
        'professions': [
            '–¥–∏–∑–∞–π–Ω–µ—Ä',
            'UX/UI –¥–∏–∑–∞–π–Ω–µ—Ä',
            '–º–æ—É—à–Ω-–¥–∏–∑–∞–π–Ω–µ—Ä',
            '–∫–æ–Ω—Ç–µ–Ω—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä',
            '–º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥'
        ],
        'description': '–¢–µ–±–µ –ø–æ–¥—Ö–æ–¥—è—Ç —Ç–≤–æ—Ä—á–µ—Å–∫–∏–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏! –¢—ã —É–º–µ–µ—à—å —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫—Ä–∞—Å–∏–≤–æ–µ –∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ, –º—ã—Å–ª–∏—à—å –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ.'
    },
    'social': {
        'name': '–†–∞–±–æ—Ç–∞ —Å –ª—é–¥—å–º–∏ üë•',
        'professions': [
            '–º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º',
            'HR-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç',
            '–º–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ–µ–∫—Ç–æ–≤',
            'PR-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç',
            '–ø—Å–∏—Ö–æ–ª–æ–≥'
        ],
        'description': '–¢–µ–±–µ –ø–æ–¥—Ö–æ–¥–∏—Ç —Ä–∞–±–æ—Ç–∞ —Å –ª—é–¥—å–º–∏! –¢—ã –ª–µ–≥–∫–æ –Ω–∞—Ö–æ–¥–∏—à—å –æ–±—â–∏–π —è–∑—ã–∫, —É–º–µ–µ—à—å —É–±–µ–∂–¥–∞—Ç—å –∏ –ø–æ–º–æ–≥–∞—Ç—å –¥—Ä—É–≥–∏–º.'
    },
    'balanced': {
        'name': '–£–Ω–∏–≤–µ—Ä—Å–∞–ª üåü',
        'professions': [
            '–ø—Ä–æ–¥–∞–∫—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä',
            '–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç',
            '–ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å',
            '–º–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ–µ–∫—Ç–æ–≤',
            '–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä'
        ],
        'description': '–£ —Ç–µ–±—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å! –¢—ã –º–æ–∂–µ—à—å —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö —Å—Ñ–µ—Ä–∞—Ö, —Å–æ—á–µ—Ç–∞—è —Ä–∞–∑–ª–∏—á–Ω—ã–µ –Ω–∞–≤—ã–∫–∏.'
    }
}


def calculate_quiz_result(answers):
    '''–ü–æ–¥—Å—á–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã'''
    trait_scores = {}

    # –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –±–∞–ª–ª—ã –ø–æ –∫–∞–∂–¥–æ–π —á–µ—Ä—Ç–µ
    for answer_idx in answers:
        question_num = answers.index(answer_idx)
        if question_num < len(QUIZ_QUESTIONS):
            question = QUIZ_QUESTIONS[question_num]
            if answer_idx < len(question['options']):
                traits = question['options'][answer_idx]['traits']
                for trait in traits:
                    trait_scores[trait] = trait_scores.get(trait, 0) + 1

    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–æ–º–∏–Ω–∏—Ä—É—é—â–∏–π –ø—Ä–æ—Ñ–∏–ª—å
    profile_scores = {
        'technical': sum([trait_scores.get(t, 0) for t in ['technical', 'logical']]),
        'analytical': sum([trait_scores.get(t, 0) for t in ['analytical', 'research', 'detail-oriented']]),
        'creative': sum([trait_scores.get(t, 0) for t in ['creative', 'artistic', 'freedom']]),
        'social': sum([trait_scores.get(t, 0) for t in ['social', 'communication', 'helping', 'leadership']]),
        'balanced': sum([trait_scores.get(t, 0) for t in ['balanced', 'adaptable', 'flexible']])
    }

    # –ù–∞—Ö–æ–¥–∏–º –ø—Ä–æ—Ñ–∏–ª—å —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –±–∞–ª–ª–æ–º
    max_profile = max(profile_scores, key=profile_scores.get)

    # –ï—Å–ª–∏ –±–∞–ª–ª—ã —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã - —É–Ω–∏–≤–µ—Ä—Å–∞–ª
    if len(set(profile_scores.values())) <= 2:
        max_profile = 'balanced'

    return {
        'profile': max_profile,
        'scores': profile_scores,
        'trait_scores': trait_scores
    }


def get_quiz_result_message(result):
    '''–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º'''
    profile = CAREER_PROFILES[result['profile']]

    message = f"üéØ <b>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞ –Ω–∞ –ø—Ä–æ—Ñ–æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é</b>\n\n"
    message += f"<b>{profile['name']}</b>\n\n"
    message += f"{profile['description']}\n\n"
    message += f"<b>–ü–æ–¥—Ö–æ–¥—è—â–∏–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏:</b>\n"

    for profession in profile['professions']:
        message += f"‚Ä¢ {profession}\n"

    message += f"\nüí° –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–∞–Ω–¥—É /search —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –∑–∞—Ä–ø–ª–∞—Ç—ã –ø–æ —ç—Ç–∏–º –ø—Ä–æ—Ñ–µ—Å—Å–∏—è–º!"

    return message


class QuizSession:
    '''–ö–ª–∞—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–µ–π –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã'''

    def __init__(self):
        self.sessions = {}

    def start_quiz(self, user_id):
        '''–ù–∞—á–∞–ª–æ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã'''
        self.sessions[user_id] = {
            'current_question': 0,
            'answers': []
        }

    def get_current_question(self, user_id):
        '''–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞'''
        if user_id not in self.sessions:
            return None

        session = self.sessions[user_id]
        question_num = session['current_question']

        if question_num >= len(QUIZ_QUESTIONS):
            return None

        return QUIZ_QUESTIONS[question_num]

    def add_answer(self, user_id, answer_idx):
        '''–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞'''
        if user_id not in self.sessions:
            return False

        self.sessions[user_id]['answers'].append(answer_idx)
        self.sessions[user_id]['current_question'] += 1
        return True

    def is_quiz_complete(self, user_id):
        '''–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã'''
        if user_id not in self.sessions:
            return False

        return self.sessions[user_id]['current_question'] >= len(QUIZ_QUESTIONS)

    def get_result(self, user_id):
        '''–ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã'''
        if user_id not in self.sessions:
            return None

        answers = self.sessions[user_id]['answers']
        return calculate_quiz_result(answers)

    def end_quiz(self, user_id):
        '''–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã'''
        if user_id in self.sessions:
            del self.sessions[user_id]

